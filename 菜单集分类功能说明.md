# 菜单集分类功能说明

## 功能概述

现在每个菜单集都可以有自己的菜品分类，不同的菜单集可以包含不同的分类，实现了更灵活的菜单管理。

## 主要变化

### 1. 数据结构更新

菜单集数据结构新增了 `categories` 字段：

```javascript
{
  id: "default",
  name: "默认菜单",
  dishes: ["1", "2", "3", "4", "5"],
  ingredients: ["1", "2", "3", "4", "5", "6"],
  categories: ["1", "2", "3", "4", "5"], // 新增字段
  isDefault: true,
  userId: "1",
  createdAt: new Date().toISOString(),
}
```

### 2. 新增的服务方法

#### menuSetService 新增方法：

- `addCategoryToMenuSet(menuSetId, categoryId)` - 添加分类到菜单集
- `removeCategoryFromMenuSet(menuSetId, categoryId)` - 从菜单集移除分类
- `getCategoriesInMenuSet(menuSetId)` - 获取菜单集中的所有分类
- `getCurrentMenuSetCategories()` - 获取当前菜单集的分类
- `getCategoriesInMenuSetByOrder(menuSetId)` - 获取菜单集中按顺序排列的分类
- `getCurrentMenuSetCategoriesByOrder()` - 获取当前菜单集按顺序排列的分类
- `getAvailableCategoriesForMenuSet(menuSetId)` - 获取菜单集中可用的分类
- `getCurrentMenuSetAvailableCategories()` - 获取当前菜单集可用的分类

### 3. 自动关联功能

- **添加菜品时自动添加分类**：当添加菜品到菜单集时，会自动添加该菜品对应的分类
- **移除分类时自动移除菜品**：当从菜单集移除分类时，会自动移除该分类下的所有菜品

### 4. 兼容性更新

菜品服务中的兼容性方法已更新为使用当前菜单集的分类：

- `getAllCategories()` - 现在返回当前菜单集的分类
- `getCategoryOrder()` - 现在返回当前菜单集按顺序排列的分类
- `saveCategoryOrder(order)` - 现在只更新当前菜单集的分类

## 使用示例

### 创建新菜单集并添加分类

```javascript
// 创建新菜单集
const newMenuSet = menuSetService.createMenuSet("我的菜单集");

// 添加分类到菜单集
menuSetService.addCategoryToMenuSet(newMenuSet.id, "1"); // 添加家常菜分类
menuSetService.addCategoryToMenuSet(newMenuSet.id, "2"); // 添加川菜分类

// 添加菜品（会自动添加对应的分类）
menuSetService.addDishToMenuSet(newMenuSet.id, "3"); // 添加清蒸鲈鱼，会自动添加海鲜分类
```

### 获取当前菜单集的分类

```javascript
// 获取当前菜单集的所有分类
const categories = menuSetService.getCurrentMenuSetCategories();

// 获取当前菜单集按顺序排列的分类
const orderedCategories = menuSetService.getCurrentMenuSetCategoriesByOrder();

// 获取当前菜单集可用的分类（未添加的分类）
const availableCategories = menuSetService.getCurrentMenuSetAvailableCategories();
```

### 获取菜品按分类分组

```javascript
// 获取当前菜单集的菜品按分类分组
const categorizedDishes = dishService.getCurrentMenuSetDishesByCategory();
```

### 移除分类

```javascript
// 从菜单集移除分类（会同时移除该分类下的所有菜品）
menuSetService.removeCategoryFromMenuSet(menuSetId, categoryId);
```

## 注意事项

1. **默认菜单集**：默认菜单集包含所有分类，作为初始状态
2. **分类管理**：分类仍然在全局管理，但每个菜单集可以选择使用哪些分类
3. **数据一致性**：添加菜品时会自动确保分类存在，移除分类时会自动清理相关菜品
4. **向后兼容**：现有的代码应该能正常工作，因为兼容性方法已更新

## 迁移说明

现有数据会自动迁移：
- 默认菜单集会包含所有现有分类
- 现有的菜品和食材关联保持不变
- 用户界面可能需要相应更新以支持新的分类管理功能 